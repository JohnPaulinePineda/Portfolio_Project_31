---
title: "R : Sample Size and Power Calculations for Tests Comparing Means in Clinical Research"
author: "John Pauline Pineda"
date: "May 7, 2023"
output: 
  html_document:
    toc: true
    toc_depth: 3
    theme: readable
    highlight: tango
    css: doc.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=15, fig.height=10)
```

# **1. Table of Contents**
|
| This document presents a non-exhaustive list of sample size and power calculations for clinical research mean comparison tests using various helpful packages in <mark style="background-color: #CCECFF">**R**</mark>. 
|
| Mean comparison tests applied during clinical research refer to trials evaluated in terms of mean responses of some primary study endpoints. The objectives of the intended clinical trials usually include the evaluation of intervention effects, demonstration of therapeutic equivalence or non-inferiority and establishment of superiority. The equations applied in this study (mostly contained in the <mark style="background-color: #CCECFF">**base**</mark> package) attempt to provide calculations for the sample size, critical value and power based on the study objectives and hypotheses of interest. 
|
##  1.1 One-Sample Design (OSD)
|
| [One-Sample Design](https://www.taylorfrancis.com/books/mono/10.1201/9781315183084/sample-size-calculations-clinical-research-shein-chung-chow-jun-shao-hansheng-wang-yuliya-lokhnygina) involves individual numeric response values from sampled subjects. In clinical research, responses could be the difference between matched pairs such as the pre-treatment and post-treatment responses or changes from baseline to endpoint within a treatment group. Responses are assumed to be independent and identically distributed normal random variables with zero mean and a given variance. Parameters needed for the computations are as follows:
|
| **[A]** <span style="color: #FF0000">Mean Response</span> : True mean response value obtained from sampled subjects 
|
| **[B]** <span style="color: #FF0000">Reference</span> : Baseline value for comparison
|
| **[C]** <span style="color: #FF0000">Standard Deviation</span> : Data variability based from literature, pilot studies or preliminary experiments
|
| **[D]** <span style="color: #FF0000">Alpha</span> : Maximum allowed Type I error
|
| **[E]** <span style="color: #FF0000">Beta</span> : Maximum allowed Type II error
|
| **[F]** <span style="color: #FF0000">Testing Margin</span> : 
|      **[F.1]** Minimum margin to establish that the mean response is much better than reference
|      **[F.2]** Minimum margin to establish that the mean response is not much worse as the reference
|      **[F.3]** Minimum margin to establish that the mean response is no better and no worse than the reference
|
| A case scenario was provided as follows to demonstrate sample size computation and power analysis applying the different types of hypotheses:
|
| **[Case Scenario]** A clinical research study is being pursued concerning osteoporosis in post-menopausal women. Osteoporosis and osteopenia (or decreased bone mass) most commonly develop in post-menopausal women. The consequences of osteoporosis are vertebral crush fractures and hip fractures. The diagnosis of osteoporosis is made when vertebral bone density is more than 10% below what is expected for sex, age, height, weight, and race. Usually, bone density is reported in terms of standard deviation (SD) from mean values. The World Health Organization (WHO) defines osteopenia as bone density value greater than one SD below peak bone mass levels in young women and osteoporosis as a value of greater than 2.5 SD below the same measurement scale. In medical practice, most clinicians suggest therapeutic intervention should be begun in patients with osteopenia to prevent progression to osteoporosis.
|
###  1.1.1 Test for Equality (OSD_EQUALITY)
|
| **[Research Question]** Suppose that the mean bone density before the treatment is 1.5 SD. After treatment, the mean value is expected to range from 2.0 to 4.0 SD with increments of 0.2. For prevention of progression from osteopenia to osteoporosis, the study aims to demonstrate that the mean bone density post-treatment and pre-treatment are different. Given a level of significance of 0.05, evaluate the sample size range for a test of equality to achieve statistical test powers equal to 70%, 80% and 90%.
|
| **[Null Hypothesis]** Post-treatment mean bone density - Post-treatment mean bone density equals 0
|
| **[Alternative Hypothesis]** Post-treatment mean bone density - Post-treatment mean bone density does not equal 0
|
| **[Statistical Decision]** Rejection of the null hypothesis implies difference between the mean bone density values post-treatment and pre-treatment
|
| **[A]** <span style="color: #FF0000">Mean Response</span> : 2.0 to 4.0 SD at 0.20 intervals 
|
| **[B]** <span style="color: #FF0000">Reference</span> : 1.5 SD
|
| **[C]** <span style="color: #FF0000">Standard Deviation</span> : Not explicitly given but already factored into the mean values and will cancel out during computation
|
| **[D]** <span style="color: #FF0000">Alpha</span> : 0.05
|
| **[E]** <span style="color: #FF0000">Beta</span> : 0.30, 0.20 and 0.10 corresponding to 70%, 80% and 90% statistical powers
|
| **[F]** <span style="color: #FF0000">Testing Margin</span> : 0 for the Test of Equality hypothesis
|
```{r section_1.1.1, warning=FALSE, message=FALSE}

##################################
# Loading R libraries
##################################
library(moments)
library(car)
library(multcomp)
library(effects)
library(psych)
library(ggplot2)
library(dplyr)
library(ggpubr)
library(rstatix)
library(ggfortify)
library(trend)

##################################
# Defining a range of possible hypothesized values for mu
##################################
mu_Response=seq(2.0,4.0,0.2)

##################################
# Defining a fixed hypothesized value for mu_0
##################################
mu_Reference=1.5

##################################
# Defining a fixed hypothesized value for the standard deviation
##################################
sd=1

##################################
# Defining a fixed hypothesized value for the Type I error
##################################
alpha=0.05

##################################
# Defining a range of possible hypothesized values for the Type II error
##################################
beta=c(0.30,0.20,0.10)

##################################
# Computing the range of samples sizes based on different levels of Type II errors
##################################
beta_1=beta[1]
(n_Beta30=(sd*(qnorm(1-alpha/2)+qnorm(1-beta_1))/(mu_Response-mu_Reference))^2)
ceiling(n_Beta30)
z_Beta30=(mu_Response-mu_Reference)/(sd/sqrt(n_Beta30))
(Power_Beta30=pnorm(z_Beta30-qnorm(1-alpha/2))+pnorm(-z_Beta30-qnorm(1-alpha/2)))

beta_2=beta[2]
(n_Beta20=(sd*(qnorm(1-alpha/2)+qnorm(1-beta_2))/(mu_Response-mu_Reference))^2)
ceiling(n_Beta20)
z_Beta30=(mu_Response-mu_Reference)/(sd/sqrt(n_Beta20))
(Power_Beta30=pnorm(z_Beta30-qnorm(1-alpha/2))+pnorm(-z_Beta30-qnorm(1-alpha/2)))

beta_3=beta[3]
(n_Beta10=(sd*(qnorm(1-alpha/2)+qnorm(1-beta_3))/(mu_Response-mu_Reference))^2)
ceiling(n_Beta10)
z_Beta30=(mu_Response-mu_Reference)/(sd/sqrt(n_Beta10))
(Power_Beta30=pnorm(z_Beta30-qnorm(1-alpha/2))+pnorm(-z_Beta30-qnorm(1-alpha/2)))

OneSampleDesign.Equality <- as.data.frame(cbind(mu_Response,n_Beta30,n_Beta20,n_Beta10))
names(OneSampleDesign.Equality) <- c("Posttreatment.Mean.Bone.Density",
                                 "Power=70%",
                                 "Power=80%",
                                 "Power=90%")

##################################
# Restructuring the data
##################################
OneSampleDesign.Equality.Reshaped <- gather(OneSampleDesign.Equality,
                                            "Power=70%","Power=80%","Power=90%",
                                            key="Power",
                                            value="Sample.Size")
OneSampleDesign.Equality.Reshaped$Label <- rep("OSD_EQUALITY",nrow(OneSampleDesign.Equality.Reshaped))

##################################
# Plotting the sample sizes and power curves
##################################
(OneSampleDesign.Equality.PowerAnalysis <- ggplot(OneSampleDesign.Equality.Reshaped,
                                                      aes(x=Posttreatment.Mean.Bone.Density,
                                                          y=Sample.Size, 
                                                          color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50)) +
  ggtitle("One-Sample Design : Test for Equality"))

```

###  1.1.2 Test for Non-Inferiority (OSD_NONINFERIORITY)
|
| **[Research Question]** Suppose that the mean bone density before the treatment is 1.5 SD. After treatment, the mean value is expected to range from 2.0 to 4.0 SD with increments of 0.2. For prevention of progression from osteopenia to osteoporosis, the study aims to demonstrate that the mean bone density post-treatment is not much worse than pre-treatment by a clinically meaningful difference equal to −0.5 SD. Given a level of significance of 0.05, evaluate the sample size range for a test of non-inferiority to achieve statistical test powers equal to 70%, 80% and 90%.
|
| **[Null Hypothesis]** Post-treatment mean bone density - Post-treatment mean bone density <= Clinically meaningful difference
|
| **[Alternative Hypothesis]** Post-treatment mean bone density - Post-treatment mean bone density > Clinically meaningful difference
|
| **[Statistical Decision]** Rejection of the null hypothesis implies non-inferiority of the mean bone density treatment as compared to non-treatment, given the testing margin
|
| **[A]** <span style="color: #FF0000">Mean Response</span> : 2.0 to 4.0 SD at 0.20 intervals 
|
| **[B]** <span style="color: #FF0000">Reference</span> : 1.5 SD
|
| **[C]** <span style="color: #FF0000">Standard Deviation</span> : Not explicitly given but already factored into the mean values and will cancel out during computation
|
| **[D]** <span style="color: #FF0000">Alpha</span> : 0.05
|
| **[E]** <span style="color: #FF0000">Beta</span> : 0.30, 0.20 and 0.10 corresponding to 70%, 80% and 90% statistical powers
|
| **[F]** <span style="color: #FF0000">Testing Margin</span> : -0.5 SD for the Test of Non-Inferiority hypothesis
|
```{r section_1.1.2, warning=FALSE, message=FALSE}
##################################
# Defining a range of possible hypothesized values for mu
##################################
mu_Response=seq(2.0,4.0,0.2)

##################################
# Defining a fixed hypothesized value for mu_0
##################################
mu_Reference=1.5

##################################
# Defining a fixed hypothesized value for the standard deviation
##################################
sd=1

##################################
# Defining a fixed hypothesized value for the Type I error
##################################
alpha=0.05

##################################
# Defining a range of possible hypothesized values for the Type II error
##################################
beta=c(0.30,0.20,0.10)

##################################
# Defining the non-inferiority testing margin
##################################
epsilon=-0.5

##################################
# Computing the range of samples sizes based on different levels of Type II errors
##################################
beta_1=beta[1]
(n_Beta30=(sd*(qnorm(1-alpha)+qnorm(1-beta_1))/(mu_Response-mu_Reference-epsilon))^2)
ceiling(n_Beta30)
z_Beta30=(mu_Response-mu_Reference-epsilon)/(sd/sqrt(n_Beta30))
(Power_Beta30=pnorm(z_Beta30-qnorm(1-alpha))+pnorm(-z_Beta30-qnorm(1-alpha)))

beta_2=beta[2]
(n_Beta20=(sd*(qnorm(1-alpha)+qnorm(1-beta_2))/(mu_Response-mu_Reference-epsilon))^2)
ceiling(n_Beta20)
z_Beta20=(mu_Response-mu_Reference-epsilon)/(sd/sqrt(n_Beta20))
(Power_Beta20=pnorm(z_Beta20-qnorm(1-alpha))+pnorm(-z_Beta20-qnorm(1-alpha)))

beta_3=beta[3]
(n_Beta10=(sd*(qnorm(1-alpha)+qnorm(1-beta_3))/(mu_Response-mu_Reference-epsilon))^2)
ceiling(n_Beta10)
z_Beta10=(mu_Response-mu_Reference-epsilon)/(sd/sqrt(n_Beta10))
(Power_Beta10=pnorm(z_Beta10-qnorm(1-alpha))+pnorm(-z_Beta10-qnorm(1-alpha)))

OneSampleDesign.NonInferiority <- as.data.frame(cbind(mu_Response,n_Beta30,n_Beta20,n_Beta10))
names(OneSampleDesign.NonInferiority) <- c("Posttreatment.Mean.Bone.Density",
                                 "Power=70%",
                                 "Power=80%",
                                 "Power=90%")

##################################
# Restructuring the data
##################################
OneSampleDesign.NonInferiority.Reshaped <- gather(OneSampleDesign.NonInferiority,
                                            "Power=70%","Power=80%","Power=90%",
                                            key="Power",
                                            value="Sample.Size")
OneSampleDesign.NonInferiority.Reshaped$Label <- rep("OSD_NONINFERIORITY",nrow(OneSampleDesign.NonInferiority.Reshaped))

##################################
# Plotting the sample sizes and power curves
##################################
(OneSampleDesign.NonInferiority.PowerAnalysis <- ggplot(OneSampleDesign.NonInferiority.Reshaped,
                                                      aes(x=Posttreatment.Mean.Bone.Density,
                                                          y=Sample.Size, 
                                                          color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50)) +
  ggtitle("One-Sample Design : Test for Non-Inferiority"))

```

###  1.1.3 Test for Superiority (OSD_SUPERIORITY)
|
| **[Research Question]** Suppose that the mean bone density before the treatment is 1.5 SD. After treatment, the mean value is expected to range from 2.0 to 4.0 SD with increments of 0.2. For prevention of progression from osteopenia to osteoporosis, the study aims to demonstrate that the mean bone density post-treatment is much better than pre-treatment by a clinically meaningful difference equal to +0.10 SD. Given a level of significance of 0.05, evaluate the sample size range for a test of superiority to achieve statistical test powers equal to 70%, 80% and 90%.
|
| **[Null Hypothesis]** Post-treatment mean bone density - Post-treatment mean bone density <= Clinically meaningful difference
|
| **[Alternative Hypothesis]** Post-treatment mean bone density - Post-treatment mean bone density > Clinically meaningful difference
|
| **[Statistical Decision]** Rejection of the null hypothesis implies non-inferiority of the mean bone density treatment as compared to non-treatment, given the testing margin
|
| **[A]** <span style="color: #FF0000">Mean Response</span> : 2.0 to 4.0 SD at 0.20 intervals 
|
| **[B]** <span style="color: #FF0000">Reference</span> : 1.5 SD
|
| **[C]** <span style="color: #FF0000">Standard Deviation</span> : Not explicitly given but already factored into the mean values and will cancel out during computation
|
| **[D]** <span style="color: #FF0000">Alpha</span> : 0.05
|
| **[E]** <span style="color: #FF0000">Beta</span> : 0.30, 0.20 and 0.10 corresponding to 70%, 80% and 90% statistical powers
|
| **[F]** <span style="color: #FF0000">Testing Margin</span> : +0.10 SD for the Test of Superiority hypothesis
|
```{r section_1.1.3, warning=FALSE, message=FALSE}
##################################
# Defining a range of possible hypothesized values for mu
##################################
mu_Response=seq(2.0,4.0,0.2)

##################################
# Defining a fixed hypothesized value for mu_0
##################################
mu_Reference=1.5

##################################
# Defining a fixed hypothesized value for the standard deviation
##################################
sd=1

##################################
# Defining a fixed hypothesized value for the Type I error
##################################
alpha=0.05

##################################
# Defining a range of possible hypothesized values for the Type II error
##################################
beta=c(0.30,0.20,0.10)

##################################
# Defining the superiority testing margin
##################################
epsilon= 0.10

##################################
# Computing the range of samples sizes based on different levels of Type II errors
##################################
beta_1=beta[1]
(n_Beta30=(sd*(qnorm(1-alpha)+qnorm(1-beta_1))/(mu_Response-mu_Reference-epsilon))^2)
ceiling(n_Beta30)
z_Beta30=(mu_Response-mu_Reference-epsilon)/(sd/sqrt(n_Beta30))
(Power_Beta30=pnorm(z_Beta30-qnorm(1-alpha))+pnorm(-z_Beta30-qnorm(1-alpha)))

beta_2=beta[2]
(n_Beta20=(sd*(qnorm(1-alpha)+qnorm(1-beta_2))/(mu_Response-mu_Reference-epsilon))^2)
ceiling(n_Beta20)
z_Beta20=(mu_Response-mu_Reference-epsilon)/(sd/sqrt(n_Beta20))
(Power_Beta20=pnorm(z_Beta20-qnorm(1-alpha))+pnorm(-z_Beta20-qnorm(1-alpha)))

beta_3=beta[3]
(n_Beta10=(sd*(qnorm(1-alpha)+qnorm(1-beta_3))/(mu_Response-mu_Reference-epsilon))^2)
ceiling(n_Beta10)
z_Beta10=(mu_Response-mu_Reference-epsilon)/(sd/sqrt(n_Beta10))
(Power_Beta10=pnorm(z_Beta10-qnorm(1-alpha))+pnorm(-z_Beta10-qnorm(1-alpha)))

OneSampleDesign.Superiority <- as.data.frame(cbind(mu_Response,n_Beta30,n_Beta20,n_Beta10))
names(OneSampleDesign.Superiority) <- c("Posttreatment.Mean.Bone.Density",
                                 "Power=70%",
                                 "Power=80%",
                                 "Power=90%")

##################################
# Restructuring the data
##################################
OneSampleDesign.Superiority.Reshaped <- gather(OneSampleDesign.Superiority,
                                            "Power=70%","Power=80%","Power=90%",
                                            key="Power",
                                            value="Sample.Size")
OneSampleDesign.Superiority.Reshaped$Label <- rep("OSD_SUPERIORITY",nrow(OneSampleDesign.Superiority.Reshaped))

##################################
# Plotting the sample sizes and power curves
##################################
(OneSampleDesign.Superiority.PowerAnalysis <- ggplot(OneSampleDesign.Superiority.Reshaped,
                                                      aes(x=Posttreatment.Mean.Bone.Density,
                                                          y=Sample.Size, 
                                                          color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50)) +
  ggtitle("One-Sample Design : Test for Superiority"))

```

###  1.1.4 Test for Equivalence (OSD_EQUIVALENCE)
|
| **[Research Question]** Suppose that the mean bone density before the treatment is 1.5 SD. After treatment, the mean value is expected to range from 2.0 to 4.0 SD with increments of 0.2. For a special investigation, the study aims to demonstrate that the mean bone density post-treatment is not much worse or better than pre-treatment by a clinically meaningful difference equal to +0.10 SD. Given a level of significance of 0.05, evaluate the sample size range for a test of non-inferiority to achieve statistical test powers equal to 70%, 80% and 90%.
|
| **[Null Hypothesis]** Absolute value of (Post-treatment mean bone density - Post-treatment mean bone density) >= Clinically meaningful difference
|
| **[Alternative Hypothesis]** Absolute value of (Post-treatment mean bone density - Post-treatment) mean bone density < Clinically meaningful difference
|
| **[Statistical Decision]** Rejection of the null hypothesis implies equivalence of the mean bone density treatment as compared to non-treatment, given the testing margin
|
| **[A]** <span style="color: #FF0000">Mean Response</span> : 2.0 to 4.0 SD at 0.20 intervals 
|
| **[B]** <span style="color: #FF0000">Reference</span> : 1.5 SD
|
| **[C]** <span style="color: #FF0000">Standard Deviation</span> : Not explicitly given but already factored into the mean values and will cancel out during computation
|
| **[D]** <span style="color: #FF0000">Alpha</span> : 0.05
|
| **[E]** <span style="color: #FF0000">Beta</span> : 0.30, 0.20 and 0.10 corresponding to 70%, 80% and 90% statistical powers
|
| **[F]** <span style="color: #FF0000">Testing Margin</span> : +0.10 SD for the Test of Superiority hypothesis
|
```{r section_1.1.4, warning=FALSE, message=FALSE}
##################################
# Defining a range of possible hypothesized values for mu
##################################
mu_Response=seq(2.0,4.0,0.2)

##################################
# Defining a fixed hypothesized value for mu_0
##################################
mu_Reference=1.5

##################################
# Defining a fixed hypothesized value for the standard deviation
##################################
sd=1

##################################
# Defining a fixed hypothesized value for the Type I error
##################################
alpha=0.05

##################################
# Defining a range of possible hypothesized values for the Type II error
##################################
beta=c(0.30,0.20,0.10)

##################################
# Defining the equivalence testing margin
##################################
epsilon= 0.10

##################################
# Computing the range of samples sizes based on different levels of Type II errors
##################################
beta_1=beta[1]
(n_Beta30=(sd*(qnorm(1-alpha)+qnorm(1-beta_1/2))/(epsilon-abs(mu_Response-mu_Reference)))^2)
ceiling(n_Beta30)
z_Beta30=(abs(mu_Response-mu_Reference)-epsilon)/(sd/sqrt(n_Beta30))
(Power_Beta30=2*(pnorm(z_Beta30-qnorm(1-alpha))+pnorm(-z_Beta30-qnorm(1-alpha)))-1)

beta_2=beta[2]
(n_Beta20=(sd*(qnorm(1-alpha)+qnorm(1-beta_2/2))/(epsilon-abs(mu_Response-mu_Reference)))^2)
ceiling(n_Beta20)
z_Beta20=(abs(mu_Response-mu_Reference)-epsilon)/(sd/sqrt(n_Beta20))
(Power_Beta20=2*(pnorm(z_Beta20-qnorm(1-alpha))+pnorm(-z_Beta20-qnorm(1-alpha)))-1)
(Power_Beta20=2*(pnorm(z_Beta20-qnorm(alpha)))-1)

beta_3=beta[3]
(n_Beta10=(sd*(qnorm(1-alpha)+qnorm(1-beta_3/2))/(epsilon-abs(mu_Response-mu_Reference)))^2)
ceiling(n_Beta10)
z_Beta10=(abs(mu_Response-mu_Reference)-epsilon)/(sd/sqrt(n_Beta10))
(Power_Beta10=2*(pnorm(z_Beta10-qnorm(1-alpha))+pnorm(-z_Beta10-qnorm(1-alpha)))-1)

OneSampleDesign.Equivalence <- as.data.frame(cbind(mu_Response,n_Beta30,n_Beta20,n_Beta10))
names(OneSampleDesign.Equivalence) <- c("Posttreatment.Mean.Bone.Density",
                                 "Power=70%",
                                 "Power=80%",
                                 "Power=90%")

##################################
# Restructuring the data
##################################
OneSampleDesign.Equivalence.Reshaped <- gather(OneSampleDesign.Equivalence,
                                            "Power=70%","Power=80%","Power=90%",
                                            key="Power",
                                            value="Sample.Size")
OneSampleDesign.Equivalence.Reshaped$Label <- rep("OSD_EQUIVALENCE",nrow(OneSampleDesign.Equivalence.Reshaped))

##################################
# Plotting the sample sizes and power curves
##################################
(OneSampleDesign.Equivalence.PowerAnalysis <- ggplot(OneSampleDesign.Equivalence.Reshaped,
                                                      aes(x=Posttreatment.Mean.Bone.Density,
                                                          y=Sample.Size, 
                                                          color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50)) +
  ggtitle("One-Sample Design : Test for Equivalence"))

```

###  1.1.5 Evaluation Summary

```{r section_1.1.5, warning=FALSE, message=FALSE}
##################################
# Consolidating the power analyses charts
##################################

OSD_EQUALITY.PowerAnalysis <- ggplot(OneSampleDesign.Equality.Reshaped,
                                     aes(x=Posttreatment.Mean.Bone.Density,
                                         y=Sample.Size, 
                                         color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   facet_grid(. ~ Label) +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50))

OSD_NONINFERIORITY.PowerAnalysis <- ggplot(OneSampleDesign.NonInferiority.Reshaped,
                                     aes(x=Posttreatment.Mean.Bone.Density,
                                         y=Sample.Size, 
                                         color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   facet_grid(. ~ Label) +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50))

OSD_SUPERIORITY.PowerAnalysis <- ggplot(OneSampleDesign.Superiority.Reshaped,
                                     aes(x=Posttreatment.Mean.Bone.Density,
                                         y=Sample.Size, 
                                         color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   facet_grid(. ~ Label) +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50))

OSD_EQUIVALENCE.PowerAnalysis <- ggplot(OneSampleDesign.Equivalence.Reshaped,
                                     aes(x=Posttreatment.Mean.Bone.Density,
                                         y=Sample.Size, 
                                         color=Power)) +
   geom_line(size=1)+
   geom_point(size=4)+
   theme_bw() +
   facet_grid(. ~ Label) +
   scale_color_brewer(palette="Paired") +
   scale_x_continuous(name="Hypothesized Post-Treatment Mean Bone Density",
                      limits=c(2,4),
                      breaks=seq(2,4,
                                 by=0.2)) +
  scale_y_continuous(name="Treatment Group Sample Size",
                     limits=c(0,100),
                     breaks=seq(0,100,by=10)) +
  theme(axis.title.x=element_text(color="black",face="bold",size=12),
        legend.position="top",
        axis.title.y=element_text(color="black",face="bold",size=12),
        plot.title=element_text(color="black",size=14,face="bold",hjust=0.50))

OSD_PowerAnalysis <- ggarrange(OSD_EQUALITY.PowerAnalysis,
                               OSD_NONINFERIORITY.PowerAnalysis,
                               OSD_SUPERIORITY.PowerAnalysis,
                               OSD_EQUIVALENCE.PowerAnalysis,
                               ncol=2, nrow=2)

annotate_figure(OSD_PowerAnalysis,
                top = text_grob("One-Sample Design Power Analysis by Statistical Hypothesis",
                                color = "black",
                                face = "bold",
                                size = 14))

```

##  1.2 Two-Sample Design (TSD)
|
| [Two-Sample Design](https://www.taylorfrancis.com/books/mono/10.1201/9781315183084/sample-size-calculations-clinical-research-shein-chung-chow-jun-shao-hansheng-wang-yuliya-lokhnygina) involves individual numeric response values from sampled subjects in between treatment and control groups, or between two competing groups. In clinical research, responses could be between a test drug and a placebo control or an active control agent; or between two competing agents. Responses are assumed to be independent normal random variables with zero mean and a given pooled variance. Parameters needed for the computations are as follows:
|
| **[A]** <span style="color: #FF0000">Mean Treatment Response</span> : True mean response value obtained from sampled subjects in the treatment group
|
| **[B]** <span style="color: #FF0000">Mean Control Response</span> : True mean response value obtained from sampled subjects in the control group
|
| **[C]** <span style="color: #FF0000">Epsilon</span> : Mean response differences between the treatment and control groups
|
| **[D]** <span style="color: #FF0000">Standard Deviation</span> : Data variability based from the from sampled subjects from both the Treatment and Control groups
|
| **[E]** <span style="color: #FF0000">Alpha</span> : Maximum allowed Type I error
|
| **[F]** <span style="color: #FF0000">Beta</span> : Maximum allowed Type II error
|
| **[G]** <span style="color: #FF0000">Kappa</span> : Matching ratio between the Treatment and Control groups
|
| **[H]** <span style="color: #FF0000">Testing Margin</span> : 
|      **[H.1]** Minimum margin to establish that the mean response is much better than reference
|      **[H.2]** Minimum margin to establish that the mean response is not much worse as the reference
|      **[H.3]** Minimum margin to establish that the mean response is no better and no worse than the reference
|
| A case scenario was provided as follows to demonstrate sample size computation and power analysis applying the different types of hypotheses:
|
| **[Case Scenario]** A clinical research study is being pursued concerning the evaluation of the effect of a test drug on cholesterol in patients with coronary heart disease (CHD). Cholesterol is the main lipid associated with arteriosclerotic vascular disease. The purpose of cholesterol testing is to identify patients at risk for arteriosclerotic heart disease. The liver metabolizes the cholesterol to its free form which is transported in the bloodtream by lipoproteins. As indicated by Pagana and Pagana (1998), nearly 75% of the cholesterol is bound to low density lipoproteins (LDLs) and 25% is bound to high density lipoproteins (HDLs). Therefore, cholesterol is the main component of LDLs and only a minimal component of HDLs and very low density lipoproteins. LDL is the most directly associated with increased risk of CHD. A pharmaceutical company is interested in conducting a clinical trial to compare two cholesterol lowering agents for treatment of patients with CHD through a parallel design. The primary efficacy parameter is the LDL.
|
###  1.2.1 Test for Equality (TSD_EQUALITY)
|
| **[Research Question]** Suppose that a difference of 3 to 12% in percent change of LDL is considered clinically meaningful difference. The study aims to demonstrate that the mean LDL percent change between the two cholesterol lowering agents are different. Given a level of significance of 0.05, standard deviation of 10% and matching ratio between both groups equal to 1, evaluate the sample size range for a test of equality to achieve statistical test powers equal to 70%, 80% and 90%.
|
| **[Null Hypothesis]** Lowering agent 1 mean LDL percent change - Lowering agent 2 mean LDL percent change equals 0
|
| **[Alternative Hypothesis]** Lowering agent 1 mean LDL percent change - Lowering agent 2 mean LDL percent does not equal 0
|
| **[Statistical Decision]** Rejection of the null hypothesis implies difference between the mean LDL percent change between both lowering agents
|
| **[A]** <span style="color: #FF0000">Epsilon</span> : 3 to 12% at 1% intervals
|
| **[B]** <span style="color: #FF0000">Standard Deviation</span> : 10%
|
| **[C]** <span style="color: #FF0000">Alpha</span> : 0.05
|
| **[D]** <span style="color: #FF0000">Beta</span> : 0.30, 0.20 and 0.10 corresponding to 70%, 80% and 90% statistical powers
|
| **[E]** <span style="color: #FF0000">Kappa</span> : 0.30, 0.20 and 0.10 corresponding to 70%, 80% and 90% statistical powers
|
| **[F]** <span style="color: #FF0000">Testing Margin</span> : 0 for the Test of Equality hypothesis
|
###  1.2.2 Test for Non-Inferiority (TSD_NONINFERIORITY)

###  1.2.3 Test for Superiority (TSD_SUPERIORITY)

###  1.2.4 Test for Equivalence (TSD_EQUIVALENCE)

###  1.2.5 Evaluation Summary

##  1.3 K-Sample Design (KSD)

###  1.3.1 Test for Equality (KSD_EQUALITY)

###  1.3.2 Test for Non-Inferiority (KSD_NONINFERIORITY)

###  1.3.3 Test for Superiority (KSD_SUPERIORITY)

###  1.3.4 Test for Equivalence (KSD_EQUIVALENCE)

###  1.3.5 Evaluation Summary

# **2. References**
|
| **[Book]** [Sample Size Calculations in Clinical Research](https://www.taylorfrancis.com/books/mono/10.1201/9781315183084/sample-size-calculations-clinical-research-shein-chung-chow-jun-shao-hansheng-wang-yuliya-lokhnygina) by Shein-Chung Chow, Jun Shao, Hansheng Wang and Yuliya Lokhnygina
| **[Book]** [Clinical Trial Data Analysis Using R and SAS](https://www.taylorfrancis.com/books/mono/10.1201/9781315155104/clinical-trial-data-analysis-using-sas-ding-geng-din-chen-karl-peace-pinggao-zhang) by Ding-Geng Chen, Karl Peace and Pinggao Zhang
| **[Book]** [Design and Analysis of Experiments with R](https://www.taylorfrancis.com/books/mono/10.1201/b17883/design-analysis-experiments-john-lawson) by John Lawson
| **[Book]** [Design and Analysis of Experiments](https://link.springer.com/book/10.1007/978-3-319-52250-0) by Angela Dean , Daniel Voss and Danel Draguljić
| **[Book]** [Design and Analysis of Experiments](https://bcs.wiley.com/he-bcs/Books?action=index&bcsId=10790&itemId=1119320933) by Douglas Montgomery
| **[Article]** [Power and Sample Size](https://powerandsamplesize.com/) by HyLown Consulting Team
| **[Article]** [An Introduction to Different Types of Study Design](https://s4be.cochrane.org/blog/2021/04/06/an-introduction-to-different-types-of-study-design/) by Hadi Abbas
| **[Article]** [Case-Control and Cohort Studies: A Brief Overview](https://s4be.cochrane.org/blog/2017/12/06/case-control-and-cohort-studies-overview/) by Saul Crandon
| **[Article]** [Cohort Studies: Prospective and Retrospective Designs](https://s4be.cochrane.org/blog/2019/03/06/cohort-studies-prospective-retrospective-designs/) by Izabel de Oliveira
| **[Article]** [Prevalence vs. Incidence: What is the Difference](https://s4be.cochrane.org/blog/2020/11/06/prevalence-vs-incidence-what-is-the-difference/) by Georgina Ford
| **[Article]** [Randomized Clinical Trial (RCT): Simple Definition, Phases, and Types](https://www.statisticshowto.com/experimental-design/randomized-clinical-trial-rcts/) by Statistics-How-To Team
|
|
|
|